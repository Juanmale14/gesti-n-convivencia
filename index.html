<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestiÃ³n del CarnÃ© de Convivencia - El Loco de la Mochila</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --primary-pastel: #e0f2f1;
            --secondary-pastel: #e3f2fd;
            --accent-green: #81c784;
            --accent-blue: #64b5f6;
            --text-main: #37474f;
            --bg-gradient: linear-gradient(135deg, #f0f9ff 0%, #e8f5e9 100%);
            --white: #ffffff;
            --danger-pastel: #ffebee;
            --success-pastel: #e8f5e9;
        }

        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--bg-gradient);
            color: var(--text-main);
            min-height: 100vh;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.8rem;
            color: #2e7d32;
            margin: 0;
            font-weight: 800;
        }

        .header p {
            color: #546e7a;
            font-size: 1.1rem;
            margin-top: 10px;
        }

        /* Botonera Inicial */
        .top-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .btn-info { background-color: var(--accent-blue); color: white; }
        .btn-test { background-color: var(--accent-green); color: white; }
        .action-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.1); }

        /* Panel Instrucciones */
        #instructions-panel {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px dashed var(--accent-blue);
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* Tabs Estilo Pastel */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: -1px;
        }

        .tab {
            padding: 15px 30px;
            background: #f1f8e9;
            border: none;
            border-radius: 20px 20px 0 0;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #689f38;
            transition: all 0.3s;
        }

        .tab.active {
            background: white;
            color: #2e7d32;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.03);
            position: relative;
            z-index: 2;
        }

        .tab-content {
            background: white;
            border-radius: 0 20px 20px 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            min-height: 400px;
        }

        .tab-pane { display: none; }
        .tab-pane.active { display: block; }

        /* Botones de AcciÃ³n Principal */
        .main-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }

        .main-btn {
            padding: 30px;
            font-size: 1.2rem;
            font-weight: 700;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: white;
        }

        .btn-sumar { background: linear-gradient(135deg, #a5d6a7, #81c784); color: #1b5e20; }
        .btn-restar { background: linear-gradient(135deg, #ffab91, #ff8a65); color: #bf360c; }
        .main-btn:hover { transform: scale(1.03); }

        /* Formulario */
        .form-container {
            display: none;
            background: #fafafa;
            padding: 30px;
            border-radius: 20px;
            border: 1px solid #eee;
            margin-top: 20px;
        }

        .form-container.active { display: block; }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group { display: flex; flex-direction: column; margin-bottom: 15px; }
        .full-width { grid-column: 1 / -1; }

        label { font-weight: 600; margin-bottom: 8px; color: #455a64; }
        select, textarea {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            background: white;
        }

        .submit-btn {
            background-color: var(--accent-blue);
            color: white;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }

        /* Estrellas */
        .star-rating { display: flex; gap: 8px; }
        .star { font-size: 2.2rem; cursor: pointer; color: #ddd; transition: 0.2s; }
        .star.active { color: #ffca28; }
        .star.hover { color: #ffe082; }

        /* GrÃ¡ficas y Stats */
        .chart-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: white;
        }

        .stat-card.positive { background: #81c784; }
        .stat-card.negative { background: #e57373; }
        .stat-card.total { background: #64b5f6; }

        .stat-number { font-size: 2.2rem; font-weight: 800; display: block; }
        .stat-label { font-size: 0.9rem; font-weight: 600; text-transform: uppercase; }

        /* Tabla */
        .summary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
            margin-top: 20px;
        }

        .summary-table th { padding: 15px; color: #78909c; text-align: left; }
        .summary-table td { padding: 15px; background: #fcfcfc; border-top: 1px solid #f1f1f1; border-bottom: 1px solid #f1f1f1; }
        .summary-table tr td:first-child { border-left: 1px solid #f1f1f1; border-radius: 10px 0 0 10px; }
        .summary-table tr td:last-child { border-right: 1px solid #f1f1f1; border-radius: 0 10px 10px 0; }

        .btn-export-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .export-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: white;
        }

        .btn-pdf { background-color: #ef5350; }
        .btn-excel { background-color: #66bb6a; }
        .btn-clear { background-color: #bdbdbd; }

        /* Footer */
        footer {
            text-align: center;
            padding: 60px 20px;
            color: #78909c;
            font-size: 1rem;
        }

        footer a {
            color: #2e7d32;
            text-decoration: none;
            font-weight: 700;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        footer a:hover {
            background: #e8f5e9;
        }

        /* AnimaciÃ³n de Guardado */
        #toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .form-grid, .main-buttons, .chart-stats { grid-template-columns: 1fr; }
        }
    </style>
<style type="text/css">
.grande { font-size: 60px; }
</style>
<script>
// Escribir aqui el cÃ³digo Javascript
</script>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1>ConvivePro</h1>
            <p>Sistema amable de gestiÃ³n del carnÃ© de convivencia escolar</p>
        </header>

        <div class="top-actions">
            <button class="action-btn btn-info" onclick="toggleInstructions()">
                ðŸ“– Instrucciones de Uso
            </button>
            <button class="action-btn btn-test" onclick="runTestMode()">
                ðŸš€ Realizar Prueba RÃ¡pida
            </button>
        </div>

        <div id="instructions-panel">
            <h3 style="margin-top: 0; color: var(--accent-blue);">Â¿CÃ³mo utilizar esta herramienta?</h3>
            <ol style="line-height: 1.6; color: #546e7a;">
                <li>Selecciona si quieres <strong>sumar</strong> puntos (conductas positivas) o <strong>restar</strong> (conductas negativas).</li>
                <li>Rellena el formulario con el grupo, el nombre del alumno y el motivo.</li>
                <li>Usa las <strong>estrellas</strong> para definir la intensidad de la acciÃ³n (1 a 5 puntos).</li>
                <li>En la pestaÃ±a de <strong>Resumen</strong>, podrÃ¡s ver las estadÃ­sticas visuales y exportar los datos a PDF o Excel.</li>
            </ol>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('tab-incidencia', this)">Registrar AcciÃ³n</button>
            <button class="tab" onclick="showTab('tab-resumen', this)">AnÃ¡lisis y Datos</button>
        </div>

        <div class="tab-content">
            <!-- REGISTRO -->
            <div id="tab-incidencia" class="tab-pane active">
                <div class="main-buttons">
                    <button class="main-btn btn-sumar" onclick="showForm('sumar')">
                        Sumar Puntos (+)
                    </button>
                    <button class="main-btn btn-restar" onclick="showForm('restar')">
                        Restar Puntos (-)
                    </button>
                </div>

                <!-- Formulario DinÃ¡mico -->
                <div id="form-container" class="form-container">
                    <h3 id="form-title" style="margin-top: 0;">Formulario</h3>
                    <form id="action-form">
                        <input type="hidden" id="action-type">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Curso / Grupo:</label>
                                <select id="grupo" required="">
                                    <option value="">Seleccionar...</option>
                                    <option>1Âº ESO A</option><option>1Âº ESO B</option>
                                    <option>2Âº ESO A</option><option>2Âº ESO B</option>
                                    <option>3Âº ESO A</option><option>3Âº ESO B</option>
                                    <option>4Âº ESO A</option><option>4Âº ESO B</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Alumna/o:</label>
                                <select id="alumno" required="">
                                    <option value="">Seleccionar...</option>
                                    <option>Ana GarcÃ­a</option><option>Juan PÃ©rez</option>
                                    <option>MarÃ­a LÃ³pez</option><option>Carlos Ruiz</option>
                                    <option>Elena Sanz</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>Nivel de impacto (Puntos):</label>
                                <div class="star-rating" id="star-container">
                                    <span class="star" data-value="1">â˜…</span>
                                    <span class="star" data-value="2">â˜…</span>
                                    <span class="star" data-value="3">â˜…</span>
                                    <span class="star" data-value="4">â˜…</span>
                                    <span class="star" data-value="5">â˜…</span>
                                </div>
                                <input type="hidden" id="puntos-value" required="">
                            </div>
                            <div class="form-group full-width">
                                <label>Observaciones / Motivo:</label>
                                <textarea id="motivo" placeholder="Ej: ColaboraciÃ³n en el aula, falta de respeto..." required=""></textarea>
                            </div>
                        </div>
                        <button type="submit" class="submit-btn" id="submit-btn">GUARDAR EN EL REGISTRO</button>
                    </form>
                </div>
            </div>

            <!-- RESUMEN -->
            <div id="tab-resumen" class="tab-pane">
                <div class="btn-export-group">
                    <button class="export-btn btn-pdf" onclick="exportToPDF()">PDF</button>
                    <button class="export-btn btn-excel" onclick="exportToCSV()">Excel/CSV</button>
                    <button class="export-btn btn-clear" onclick="clearAllData()">Limpiar Todo</button>
                </div>

                <div class="chart-stats">
                    <div class="stat-card positive">
                        <span class="stat-number" id="stat-pos">0</span>
                        <span class="stat-label">Ganados</span>
                    </div>
                    <div class="stat-card negative">
                        <span class="stat-number" id="stat-neg">0</span>
                        <span class="stat-label">Perdidos</span>
                    </div>
                    <div class="stat-card total">
                        <span class="stat-number" id="stat-total">0</span>
                        <span class="stat-label">Balance</span>
                    </div>
                </div>

                <div id="table-container">
                    <!-- DinÃ¡mico -->
                </div>
            </div>
        </div>
    </div>

    <div id="toast">Â¡Guardado con Ã©xito!</div>

    <footer>
        Creado con cariÃ±o por <a href="https://blogsaverroes.juntadeandalucia.es/ellocodelamochila/" target="_blank">El loco de la mochila</a>
    </footer>

    <script>
        let data = JSON.parse(localStorage.getItem('convivencia_data')) || [];

        // Cambiar pestaÃ±as
        function showTab(id, el) {
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            if(id === 'tab-resumen') updateSummary();
        }

        // Mostrar formulario
        function showForm(tipo) {
            const container = document.getElementById('form-container');
            const title = document.getElementById('form-title');
            const btn = document.getElementById('submit-btn');
            const actionInput = document.getElementById('action-type');

            container.classList.add('active');
            actionInput.value = tipo;

            if(tipo === 'sumar') {
                title.innerText = "Sumar Puntos Positivos";
                title.style.color = "#2e7d32";
                btn.style.backgroundColor = "#81c784";
            } else {
                title.innerText = "Restar Puntos por Incidencia";
                title.style.color = "#d32f2f";
                btn.style.backgroundColor = "#e57373";
            }
            window.scrollTo({ top: container.offsetTop - 50, behavior: 'smooth' });
        }

        // LÃ³gica de estrellas
        const stars = document.querySelectorAll('.star');
        stars.forEach(s => {
            s.addEventListener('mouseover', function() {
                resetStars();
                highlightStars(this.dataset.value);
            });
            s.addEventListener('click', function() {
                document.getElementById('puntos-value').value = this.dataset.value;
                setStars(this.dataset.value);
            });
        });

        function highlightStars(v) {
            stars.forEach(s => { if(s.dataset.value <= v) s.classList.add('hover'); });
        }
        function resetStars() {
            stars.forEach(s => s.classList.remove('hover'));
        }
        function setStars(v) {
            stars.forEach(s => {
                s.classList.remove('active');
                if(s.dataset.value <= v) s.classList.add('active');
            });
        }

        // Guardar datos
        document.getElementById('action-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const tipo = document.getElementById('action-type').value;
            const puntosRaw = document.getElementById('puntos-value').value;
            
            if(!puntosRaw) { showToast("Â¡Selecciona las estrellas!"); return; }

            const entry = {
                id: Date.now(),
                tipo: tipo,
                grupo: document.getElementById('grupo').value,
                alumno: document.getElementById('alumno').value,
                puntos: tipo === 'sumar' ? parseInt(puntosRaw) : -parseInt(puntosRaw),
                motivo: document.getElementById('motivo').value,
                fecha: new Date().toLocaleDateString('es-ES')
            };

            data.push(entry);
            localStorage.setItem('convivencia_data', JSON.stringify(data));
            
            showToast("Registro guardado correctamente");
            this.reset();
            setStars(0);
            document.getElementById('form-container').classList.remove('active');
        });

        // Modo Prueba
        function runTestMode() {
            const testData = [
                { id: 1, tipo: 'sumar', grupo: '1Âº ESO A', alumno: 'Ana GarcÃ­a', puntos: 5, motivo: 'Ayudar a un compaÃ±ero con movilidad reducida', fecha: '01/01/2026' },
                { id: 2, tipo: 'restar', grupo: '2Âº ESO B', alumno: 'Juan PÃ©rez', puntos: -2, motivo: 'Llegar tarde reiteradamente', fecha: '02/01/2026' },
                { id: 3, tipo: 'sumar', grupo: '1Âº ESO B', alumno: 'MarÃ­a LÃ³pez', puntos: 3, motivo: 'ParticipaciÃ³n brillante en debate', fecha: '03/01/2026' }
            ];
            data = testData;
            localStorage.setItem('convivencia_data', JSON.stringify(data));
            updateSummary();
            showTab('tab-resumen', document.querySelectorAll('.tab')[1]);
            showToast("Datos de prueba cargados");
        }

        function toggleInstructions() {
            const p = document.getElementById('instructions-panel');
            p.style.display = p.style.display === 'block' ? 'none' : 'block';
        }

        function updateSummary() {
            const container = document.getElementById('table-container');
            let pos = 0, neg = 0;

            if(data.length === 0) {
                container.innerHTML = "<p style='text-align:center; color:#999; margin:40px;'>No hay registros todavÃ­a.</p>";
                return;
            }

            let html = `<table class="summary-table">
                <thead><tr><th>Fecha</th><th>Alumno</th><th>Grupo</th><th>Puntos</th><th>Motivo</th></tr></thead>
                <tbody>`;
            
            data.forEach(item => {
                if(item.puntos > 0) pos += item.puntos; else neg += Math.abs(item.puntos);
                html += `<tr>
                    <td>${item.fecha}</td>
                    <td><strong>${item.alumno}</strong></td>
                    <td>${item.grupo}</td>
                    <td style="color:${item.puntos > 0 ? '#2e7d32':'#d32f2f'}; font-weight:bold">${item.puntos > 0 ? '+'+item.puntos : item.puntos}</td>
                    <td style="font-size:0.9rem">${item.motivo}</td>
                </tr>`;
            });
            html += "</tbody></table>";
            container.innerHTML = html;

            document.getElementById('stat-pos').innerText = pos;
            document.getElementById('stat-neg').innerText = neg;
            document.getElementById('stat-total').innerText = pos - neg;
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        function clearAllData() {
            if(confirm("Â¿Eliminar todos los registros permanentemente?")) {
                data = [];
                localStorage.removeItem('convivencia_data');
                updateSummary();
                showToast("Datos eliminados");
            }
        }

        function exportToCSV() {
            if(data.length === 0) return;
            let csv = "Fecha,Alumno,Grupo,Puntos,Motivo\n";
            data.forEach(i => csv += `${i.fecha},${i.alumno},${i.grupo},${i.puntos},${i.motivo}\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', 'convivencia.csv');
            a.click();
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(20);
            doc.text("Informe de Convivencia - ConvivePro", 15, 20);
            doc.setFontSize(12);
            let y = 40;
            data.forEach((i, idx) => {
                doc.text(`${idx+1}. ${i.fecha} | ${i.alumno} (${i.grupo}) | Puntos: ${i.puntos}`, 15, y);
                doc.setFontSize(10);
                doc.text(`Motivo: ${i.motivo}`, 20, y+5);
                doc.setFontSize(12);
                y += 15;
            });
            doc.save("informe-convivencia.pdf");
        }
    </script>


</body></html>